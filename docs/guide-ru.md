# devdash — Руководство пользователя

devdash — терминальный дашборд для управления локальными dev-процессами. Запускает сервисы, показывает логи в реальном времени, позволяет искать, копировать и взаимодействовать с процессами — всё в одном окне терминала.

Процессы работают в фоне: можно закрыть devdash и вернуться позже — все сервисы продолжат работу.

## Установка

```bash
# macOS / Linux (Homebrew)
brew install kimaguri/simplx-toolkit/devdash

# Или через Go
go install github.com/kimaguri/simplx-toolkit/cmd/local@latest
```

Проверка:

```bash
devdash --version
```

---

## Первый запуск

```bash
devdash
```

При первом запуске откроется окно **настроек** — devdash попросит указать директории для сканирования. Это папки, в которых лежат ваши git-репозитории.

Например, если проекты лежат в `~/projects` и `~/work`:

1. Нажмите `a`
2. Введите `~/projects`, нажмите `Enter`
3. Нажмите `a` ещё раз
4. Введите `~/work`, нажмите `Enter`
5. Нажмите `Esc` — настройки сохранятся

devdash просканирует эти директории и найдёт все git-репозитории, worktree и проекты внутри них.

> Настройки хранятся в `~/.config/local-dev/config.json`. Открыть настройки снова можно в любой момент клавишей `s`.

---

## Главный экран

После настройки вы увидите дашборд с двумя панелями:

```
┌─ Сессии ────────────┬─ Логи ─────────────────────────────┐
│                      │                                    │
│   (пусто)            │   Выберите сессию для просмотра    │
│                      │                                    │
└──────────────────────┴────────────────────────────────────┘
 n:запуск  k:стоп  r:рестарт  enter:полный экран  s:настройки
```

- **Левая панель** — список запущенных процессов
- **Правая панель** — логи выбранного процесса

Переключение фокуса между панелями — `Tab`.

---

## Запуск процесса

Нажмите `n` — откроется мастер запуска из 5 шагов.

### Шаг 1: Выбор репозитория

Список всех найденных git-репозиториев и worktree, отсортированных по дате последнего коммита. Выберите нужный стрелками и нажмите `Enter`.

### Шаг 2: Выбор проекта

Если в репозитории несколько проектов (монорепо), выберите конкретный. devdash автоматически определяет тип проекта:

- `[encore]` — Encore.ts приложение
- `[pnpm]` / `[npm]` / `[yarn]` / `[bun]` — Node.js проект с соответствующим пакетным менеджером

### Шаг 3: Выбор скрипта

Список скриптов из `package.json` (dev, start, build и т.д.). Для Encore-проектов этот шаг пропускается — используется `encore run`.

### Шаг 4: Порт

devdash попытается определить порт автоматически из конфигов проекта (vite.config.ts, webpack.config.js, .env.local). Если не удалось — предложит 3000 по умолчанию. Можно ввести свой порт.

Порт запоминается для каждого проекта — при следующем запуске будет предложен тот же.

### Шаг 5: Подтверждение

Сводка: что запускается, какой командой, на каком порту. Нажмите `Enter` для запуска.

> Если в проекте нет `node_modules`, devdash предложит установить зависимости перед запуском.

> `Esc` на любом шаге — вернуться назад. `Esc` на первом шаге — отмена.

---

## Работа с процессами

После запуска процесс появится в левой панели:

```
┌─ Сессии ────────────┬─ Логи ─────────────────────────────┐
│ * api-gateway :4000  │ [12:30:01] Server started on :4000 │
│   core-ui     :4173  │ [12:30:02] Ready in 1.2s           │
│ ! foreman-bot :3001  │ [12:30:03] Watching for changes... │
└──────────────────────┴────────────────────────────────────┘
```

Статусы:
- `*` (зелёный) — работает
- `-` (жёлтый) — остановлен
- `!` (красный) — ошибка

### Управление

| Клавиша | Действие |
|---------|----------|
| `k` | Остановить выбранный процесс |
| `r` | Перезапустить выбранный процесс |
| `n` | Запустить новый процесс |

Перед остановкой и перезапуском появится диалог подтверждения. Быстрый ответ: `y` — да, `n` — нет.

### Фоновая работа

Когда вы нажимаете `q` для выхода — процессы **не останавливаются**. Они продолжают работать в фоне.

При следующем запуске `devdash` автоматически подключится ко всем работающим процессам и покажет их логи.

---

## Просмотр логов

### В дашборде

Правая панель показывает логи выбранного процесса. Логи обновляются в реальном времени, автоматически прокручиваясь вниз.

| Клавиша | Действие |
|---------|----------|
| `G` | Перейти в конец (включить автопрокрутку) |
| `g` | Перейти в начало |
| `↑` / `↓` | Прокрутка по строкам |
| `PgUp` / `PgDn` | Прокрутка по страницам |

### Полноэкранный режим

Нажмите `Enter` на любом процессе — логи развернутся на весь экран. Выход: `q` или `Esc`.

---

## Поиск по логам

Нажмите `/` в панели логов (или в полноэкранном режиме).

1. Введите текст для поиска (регистр не учитывается)
2. Нажмите `Enter` — совпадения подсветятся жёлтым
3. Навигация по совпадениям:
   - `n` — следующее совпадение
   - `N` — предыдущее совпадение
4. `Esc` — закрыть поиск

В строке поиска отображается счётчик: `[3/15]` — третье из пятнадцати совпадений.

Чтобы изменить запрос — нажмите `/` снова.

---

## Копирование логов

Три способа скопировать логи в буфер обмена:

| Клавиша | Что копируется |
|---------|---------------|
| `c` | Видимые строки (то что на экране) |
| `y` | Весь буфер логов целиком |
| `v` → выделить → `y` | Выбранный диапазон строк |

После копирования в статусной строке появится `[Copied N lines]`.

Работает через SSH (OSC52) и локально (pbcopy/xclip).

### Выделение строк

Нажмите `v` — включится режим визуального выделения (как в Vim):

| Клавиша | Действие |
|---------|----------|
| `j` / `↓` | Расширить выделение вниз |
| `k` / `↑` | Расширить выделение вверх |
| `G` | Выделить до конца |
| `g` | Выделить до начала |
| `Ctrl+D` | Страница вниз |
| `Ctrl+U` | Страница вверх |
| `y` | Скопировать и выйти |
| `Esc` | Отмена |

Выделенные строки подсвечиваются голубым.

---

## Интерактивный режим

Некоторые процессы запрашивают ввод (пароли, меню выбора, интерактивные промпты). Для этого есть интерактивный режим.

Нажмите `i` — все нажатия клавиш будут отправляться напрямую процессу. Это полноценный терминал: работают стрелки, Enter, Ctrl+C и т.д.

Чтобы выйти из интерактивного режима: `Ctrl+]`.

> Интерактивный режим доступен только для процессов, запущенных в текущей сессии devdash (не для переподключённых).

---

## Настройки

Нажмите `s` в любой момент.

| Клавиша | Действие |
|---------|----------|
| `a` | Добавить директорию для сканирования |
| `d` / `x` | Удалить выбранную директорию |
| `r` | Пересканировать (найти новые репозитории) |
| `Esc` | Закрыть и сохранить |

При добавлении можно использовать `~/` — devdash развернёт в домашнюю директорию.

Рядом с каждой директорией показывается количество найденных репозиториев.

---

## Какие проекты находит devdash

devdash сканирует директории до 2 уровней вглубь и ищет:

| Тип проекта | Как определяет | Команда запуска |
|-------------|---------------|-----------------|
| Encore | Файл `encore.app` | `encore run --port {PORT}` |
| pnpm workspace | `pnpm-workspace.yaml` + пакеты | `pnpm --filter {пакет} run {скрипт}` |
| Node.js (pnpm) | `pnpm-lock.yaml` | `pnpm run {скрипт}` |
| Node.js (npm) | `package-lock.json` | `npm run {скрипт}` |
| Node.js (yarn) | `yarn.lock` | `yarn run {скрипт}` |
| Node.js (bun) | `bun.lockb` | `bun run {скрипт}` |

Git worktree определяются автоматически и группируются с родительским репозиторием.

---

## Где хранятся данные

```
~/.config/local-dev/
├── config.json       — настройки (директории, порты)
├── sessions/         — состояние процессов (по файлу на каждый)
└── logs/             — логи процессов (сохраняются между перезапусками)
```

Логи сохраняются на диск, поэтому при переподключении к процессу вы увидите всю историю с момента запуска.

Чтобы очистить старые логи, удалите файлы из `~/.config/local-dev/logs/`.

---

## Краткая шпаргалка

```
НАВИГАЦИЯ
  Tab         Переключить панель (список ↔ логи)
  ↑/↓ или j/k Выбор процесса / прокрутка логов
  Enter       Полноэкранные логи
  q / Esc     Назад / выход

ПРОЦЕССЫ
  n           Запустить новый
  k           Остановить
  r           Перезапустить

ЛОГИ
  G           В конец (автопрокрутка)
  g           В начало
  /           Поиск
  n/N         Следующее/предыдущее совпадение
  c           Копировать видимое
  y           Копировать всё
  v           Выделение строк

ИНТЕРАКТИВ
  i           Войти (ввод идёт в процесс)
  Ctrl+]      Выйти

НАСТРОЙКИ
  s           Открыть настройки
  a           Добавить директорию
  d/x         Удалить директорию
  r           Пересканировать
```
